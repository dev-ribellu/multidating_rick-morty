<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rick & Morty Random Character</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        img {
            max-width: 200px;
            border-radius: 10px;
        }
        #locationsList {
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
            margin: 20px auto;
            max-width: 600px;
            border: 1px solid #ccc;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Random Rick & Morty Character</h1>
    <button id="fetchCharacter">Get Random Character</button>
    <button id="fetchLocations">Get All Locations</button>
    <div id="characterInfo">
        <h2 id="characterName"></h2>
        <img id="characterImage" src="" alt="Character Image">
        <p id="characterStatus"></p>
    </div>

    <div id="locationsList"></div>

    <script>

        document.getElementById('fetchCharacter').addEventListener('click', async () => {
            const randomId = Math.floor(Math.random() * 826) + 1; // API has 826 characters
            const response = await fetch(`https://rickandmortyapi.com/api/character/${randomId}`);
            const character = await response.json();

            document.getElementById('characterName').textContent = character.name;
            document.getElementById('characterImage').src = character.image;
            document.getElementById('characterImage').alt = character.name;
            document.getElementById('characterStatus').textContent = `Status: ${character.status}`;
            console.log(character);
        });
        const reponsePage = await fetch(`https://rickandmortyapi.com/api/character/?page=${page}`);
        const dataPage = await reponsePage.json();

        console.log(dataPage);

        // MÉTHODE 1 : Récupérer toutes les locations via l'endpoint /location
        document.getElementById('fetchLocations').addEventListener('click', async () => {
            const locationsList = document.getElementById('locationsList');
            locationsList.innerHTML = '<p>Chargement...</p>';
            
            try {
                const allLocations = [];
                let page = 1;
                let hasNextPage = true;

                // Parcourir toutes les pages de locations
                while (hasNextPage) {
                    const response = await fetch(`https://rickandmortyapi.com/api/location?page=${page}`);
                    const data = await response.json();
                    
                    allLocations.push(...data.results);
                    
                    hasNextPage = data.info.next !== null;
                    page++;
                }

                // Afficher les locations
                locationsList.innerHTML = `
                    <h3>Total: ${allLocations.length} locations</h3>
                    <ul>
                        ${allLocations.map(loc => `
                            <li>
                                <strong>${loc.name}</strong> 
                                (${loc.type} - ${loc.dimension})
                            </li>
                        `).join('')}
                    </ul>
                `;
                
                console.log('Toutes les locations:', allLocations);

            } catch (error) {
                locationsList.innerHTML = '<p>Erreur lors du chargement</p>';
                console.error(error);
            }
        });

        // MÉTHODE 2 : Récupérer les locations uniques depuis les personnages
        async function getLocationsFromCharacters() {
            const allLocations = new Set();
            let page = 1;
            let hasNextPage = true;

            while (hasNextPage) {
                const response = await fetch(`https://rickandmortyapi.com/api/character?page=${page}`);
                const data = await response.json();
                
                data.results.forEach(character => {
                    if (character.origin && character.origin.name) {
                        allLocations.add(character.origin.name);
                    }
                    if (character.location && character.location.name) {
                        allLocations.add(character.location.name);
                    }
                });
                
                hasNextPage = data.info.next !== null;
                page++;
            }

            return Array.from(allLocations);
        }

        // Exemple d'utilisation de la méthode 2
        // getLocationsFromCharacters().then(locations => {
        //     console.log('Locations depuis les personnages:', locations);
        // });
    </script>
</body>
</html>